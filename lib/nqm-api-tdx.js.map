{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap e3045fd0b855a7828184","webpack:///external \"debug\"","webpack:///./src/helpers.js","webpack:///external \"base-64\"","webpack:///./src/api-tdx.js","webpack:///external \"@nqminds/isomorphic-fetch\"","webpack:///external \"bluebird\""],"names":["Promise","pollingRetries","pollingInterval","waitInfinitely","fetchWithDeadline","request","log","resolve","reject","deadline","setTimeout","config","networkTimeout","Error","then","response","clearTimeout","TDXApiError","message","stack","name","prototype","Object","create","constructor","handleError","source","failure","code","internal","from","JSON","stringify","buildCommandRequest","command","data","contentType","async","commandMode","Request","commandServer","method","mode","headers","Headers","accessToken","body","buildDatabotHostRequest","databotServer","buildQueryRequest","endpoint","filter","projection","options","query","indexOf","queryServer","buildDatabotInstanceRequest","checkResponse","json","ok","error","error_description","status","setDefaults","tdxServer","tdxHost","commandHost","databotHost","queryHost","protocolComponents","split","length","protocol","hostComponents","hostname","slice","join","waitForResource","resourceId","check","retryCount","maxRetries","getResource","resource","checkResult","call","catch","err","parseError","parse","parseEx","waitForIndex","datasetId","initialStatus","builtIndexCheck","dataset","indexStatus","continueWaiting","Math","min","errLog","TDXApi","id","secret","ttl","ip","credentials","encodeURIComponent","encode","uri","grant_type","accessTokenTTL","bind","result","access_token","username","approved","key","verified","wait","accountId","sourceId","access","rid","aid","src","acc","concat","resourceIdList","payload","file","stream","size","text","spread","fromParentId","toParentId","res","addedBy","by","schema","shareMode","allowPermissive","permissiveShare","update","postData","upsert","__upsert","instanceId","processId","hostId","hostIp","hostPort","databotId","instanceData","output","pipeline","getAggregateDataStream","getDatasetDataStream","noThrow","schemaId","getResources","tdx"],"mappings":"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","file":"nqm-api-tdx.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"debug\"), require(\"base-64\"), require(\"@nqminds/isomorphic-fetch\"), require(\"bluebird\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"nqm-api-tdx\", [\"debug\", \"base-64\", \"@nqminds/isomorphic-fetch\", \"bluebird\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"nqm-api-tdx\"] = factory(require(\"debug\"), require(\"base-64\"), require(\"@nqminds/isomorphic-fetch\"), require(\"bluebird\"));\n\telse\n\t\troot[\"nqm-api-tdx\"] = factory(root[\"debug\"], root[\"base-64\"], root[\"@nqminds/isomorphic-fetch\"], root[\"bluebird\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_2__, __WEBPACK_EXTERNAL_MODULE_4__, __WEBPACK_EXTERNAL_MODULE_5__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e3045fd0b855a7828184","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"debug\"\n// module id = 0\n// module chunks = 0","import debug from \"debug\";\nimport Promise from \"bluebird\";\nimport fetch from \"@nqminds/isomorphic-fetch\";\n\n// Bind to bluebird promise library for now.\nfetch.Promise = Promise;\n\nconst pollingRetries = 15;\nconst pollingInterval = 1000;\nconst waitInfinitely = -1;\n\nconst fetchWithDeadline = function(request) {\n  const log = debug(\"nqm-api-tdx:fetchWithDeadline\");\n\n  //\n  // Implement a timeout. We have to do this manually pending a native fix\n  // on fetch() - see https://github.com/whatwg/fetch/issues/20).\n  //\n  return new Promise((resolve, reject) => {\n    // Reject the promise if the timeout expires.\n    const deadline = setTimeout(\n      () => {\n        log(\"deadline expired after %d ms\", this.config.networkTimeout);\n        reject(new Error(`deadline expired after ${this.config.networkTimeout} ms`));\n      },\n      this.config.networkTimeout\n    );\n\n    fetch(request).then(\n      (response) => {\n        // Cancel pending deadline.\n        clearTimeout(deadline);\n        // Forward response.\n        resolve(response);\n      },\n      reject // Blindly forward all rejections.\n    );\n  });\n};\n\nconst TDXApiError = function(message, stack) {\n  this.name = \"TDXApiError\";\n  this.message = message || \"no message given\";\n  this.stack = stack || (new Error()).stack;\n};\n\nTDXApiError.prototype = Object.create(Error.prototype);\nTDXApiError.prototype.constructor = TDXApiError;\n\n/**\n * Formats a TDXApiError object.\n * @param  {string} source - The source of the error, usually a function name.\n * @param  {object} failure - The error details, in the form `{code: xxx, message: yyy}`\n * @param  {string} code - The error code, usually the response status code, e.g. 422, 401 etc.\n */\nconst handleError = function(source, failure, code) {\n  const internal = {\n    from: source,\n    failure: JSON.stringify(failure),\n    code: typeof code === \"undefined\" ? \"n/a\" : code,\n  };\n  return new TDXApiError(JSON.stringify(internal), (new Error()).stack);\n};\n\n/**\n * Builds a Request object for the given command bound to the TDX command service.\n * @param  {string} command - the target TDX command, e.g. \"resource/create\"\n * @param  {object} data - the command payload\n * @param  {string} [contentType=application/json] - the content type\n * @param  {bool} [noSync=false] - send command asynchronously\n */\nconst buildCommandRequest = function(command, data, contentType, async) {\n  const commandMode = async ? \"command\" : \"commandSync\";\n  contentType = contentType || \"application/json\";\n  return new Request(`${this.config.commandServer}/${commandMode}/${command}`, {\n    method: \"POST\",\n    mode: \"cors\",\n    headers: new Headers({\n      \"Authorization\": `Bearer ${this.accessToken}`,\n      \"Content-Type\": contentType,\n    }),\n    body: JSON.stringify(data),\n  });\n};\n\n/**\n * Builds a Request object for the given command bound to the TDX databot service.\n * @param  {string} command - the target TDX command, e.g. \"register\"\n * @param  {object} data - the command payload\n * @param  {string} [contentType=application/json] - the content type\n */\nconst buildDatabotHostRequest = function(command, data) {\n  return new Request(`${this.config.databotServer}/host/${command}`, {\n    method: \"POST\",\n    mode: \"cors\",\n    headers: new Headers({\n      \"Authorization\": `Bearer ${this.accessToken}`,\n      \"Content-Type\": \"application/json\",\n    }),\n    body: JSON.stringify(data),\n  });\n};\n\n/**\n * Builds a Request object for the given query bound to the TDX query engine.\n * @param  {string} endpoint - the query endpoint, e.g. \"resources/DKJF8d8f\"\n * @param  {object} [filter] - a filter expression, e.g. {\"temperature\": {$gt: 18}}\n * @param  {object} [projection] - a projection definition defining what data will be returned, e.g. {sensorId: 1,\n * temperature: 1}\n * @param  {object} [options] - query options, e.g. {limit: 10, sort: {timestamp: -1}}\n */\nconst buildQueryRequest = function(endpoint, filter, projection, options) {\n  filter = filter ? JSON.stringify(filter) : \"\";\n  projection = projection ? JSON.stringify(projection) : \"\";\n  options = options ? JSON.stringify(options) : \"\";\n  let query;\n  if (endpoint.indexOf(\"?\") < 0) {\n    // There is no query portion in the prefix - add one now.\n    query = `${endpoint}?filter=${filter}&proj=${projection}&opts=${options}`;\n  } else {\n    // There is already a query portion, so append the params.\n    query = `${endpoint}&filter=${filter}&proj=${projection}&opts=${options}`;\n  }\n  return new Request(`${this.config.queryServer}${query}`, {\n    method: \"GET\",\n    mode: \"cors\",\n    headers: new Headers({\n      \"Authorization\": `Bearer ${this.accessToken}`,\n      \"Content-Type\": \"application/json\",\n    }),\n  });\n};\n\n/**\n * Builds a Request object for the given databot instance query bound to the TDX databot server.\n * @param  {string} endpoint - the databot query endpoint, e.g. \"status/jDduieG7\"\n */\nconst buildDatabotInstanceRequest = function(endpoint) {\n  return new Request(`${this.config.databotServer}/instance/${endpoint}`, {\n    method: \"GET\",\n    mode: \"cors\",\n    headers: new Headers({\n      \"Authorization\": `Bearer ${this.accessToken}`,\n      \"Content-Type\": \"application/json\",\n    }),\n  });\n};\n\nconst checkResponse = function(source, response) {\n  return response.json()\n    .then((json) => {\n      if (response.ok) {\n        return Promise.resolve(json);\n      } else {\n        if (json.error) {\n          // Build a failure object from the json response.\n          const failure = {code: json.error, message: json.error_description};\n          return Promise.reject(handleError(source, failure, response.status));\n        } else {\n          // The response body holds the error details.\n          return Promise.reject(handleError(source, json, response.status));\n        }\n      }\n    });\n};\n\nconst setDefaults = function(config) {\n  const log = debug(\"nqm-api-tdx:setDefaults\");\n\n  // Legacy config support.\n  config.tdxServer = config.tdxServer || config.tdxHost;\n  config.commandServer = config.commandServer || config.commandHost;\n  config.databotServer = config.databotServer || config.databotHost;\n  config.queryServer = config.queryServer || config.queryHost;\n\n  if (config.tdxServer && (!config.queryServer || !config.commandServer)) {\n    const protocolComponents = config.tdxServer.split(\"://\");\n    if (protocolComponents.length !== 2) {\n      throw new Error(`invalid tdxServer in config - no protocol: ${config.tdxServer}`);\n    }\n    const protocol = protocolComponents[0];\n    const hostComponents = protocolComponents[1].split(\".\");\n    if (hostComponents.length < 3) {\n      throw new Error(`invalid tdxServer in config - expected sub.domain.tld: ${config.tdxServer}`);\n    }\n    const hostname = hostComponents.slice(1).join(\".\");\n    config.databotServer = config.databotServer || `${protocol}://databot.${hostname}`;\n    config.commandServer = config.commandServer || `${protocol}://cmd.${hostname}`;\n    config.queryServer = config.queryServer || `${protocol}://q.${hostname}`;\n  }\n\n  // Append version qualifier to query path.\n  config.queryServer = config.queryServer && `${config.queryServer}/v1/`;\n\n  log(\n    \"using hosts: command %s, databot %s, query %s, auth %s\",\n    config.commandServer || \"[n/a]\",\n    config.databotServer || \"[n/a]\",\n    config.queryServer || \"[n/a]\",\n    config.tdxServer || \"[n/a]\",\n  );\n\n  // Default network timeout to 5 seconds.\n  config.networkTimeout = config.networkTimeout || 120000;\n};\n\nconst waitForResource = function(resourceId, check, retryCount, maxRetries) {\n  const log = debug(\"nqm-api-tdx:waitForResource\");\n  retryCount = retryCount || 0;\n  return this.getResource(resourceId)\n    .then((resource) => {\n      const checkResult = check(resource, retryCount);\n      if (checkResult instanceof Error) {\n        log(\"waitForResource - check failed with error [%s]\", checkResult.message);\n        return Promise.reject(checkResult);\n      }\n\n      if (!checkResult) {\n        // A negative maxRetries value will retry indefinitely.\n        if (maxRetries >= 0 && retryCount > maxRetries) {\n          log(\"giving up after %d attempts\", retryCount);\n          return Promise.reject(new Error(`gave up waiting for ${resourceId} after ${retryCount} attempts`));\n        }\n\n        // Try again after a delay.\n        log(\"waiting for %d msec\", pollingInterval);\n        return new Promise((resolve) => {\n          setTimeout(() => {\n            log(\"trying again\");\n            resolve(waitForResource.call(this, resourceId, check, retryCount + 1, maxRetries));\n          }, pollingInterval);\n        });\n      } else {\n        return resource;\n      }\n    })\n    .catch((err) => {\n      if (err.name !== \"TDXApiError\") {\n        return Promise.reject(err);\n      } else {\n        try {\n          const parseError = JSON.parse(err.message);\n          const failure = JSON.parse(parseError.failure);\n          // Restify error code had the 'Error' suffix removed post v3.x\n          if (\n            failure.code === \"NotFound\" ||\n            failure.code === \"NotFoundError\" ||\n            failure.code === \"Unauthorized\" ||\n            failure.code === \"UnauthorizedError\"\n          ) {\n            // Ignore resource not found and not authorized errors here, they are probably caused by\n            // waiting for the projections to catch up (esp. in debug environments) by falling through\n            // we will still be limited by the retry count, so won't loop forever.\n            log(\"ignoring error %s\", err.message);\n            return new Promise((resolve) => {\n              setTimeout(() => {\n                resolve(waitForResource.call(this, resourceId, check, retryCount + 1, maxRetries));\n              }, pollingInterval);\n            });\n          } else {\n            // All other errors are fatal.\n            return Promise.reject(err);\n          }\n        } catch (parseEx) {\n          // Failed to parse TDX error - re-throw the original error.\n          log(\"failure: [%s]\", parseEx.message);\n          return Promise.reject(err);\n        }\n      }\n    });\n};\n\nconst waitForIndex = function(datasetId, status, maxRetries) {\n  const log = debug(\"nqm-api-tdx:waitForIndex\");\n\n  // The argument maxRetries is optional.\n  if (typeof maxRetries === \"undefined\") {\n    maxRetries = waitInfinitely;\n  }\n  status = status || \"built\";\n\n  let initialStatus = \"\";\n\n  const builtIndexCheck = function(dataset, retryCount) {\n    log(\"builtIndexCheck: %s\", dataset ? dataset.indexStatus : \"no dataset\");\n\n    let continueWaiting;\n\n    // Handle \"error\" index status.\n    if (dataset && dataset.indexStatus === \"error\") {\n      if (!initialStatus) {\n        // Haven't got an initial status yet, so can't make a judgment as to whether or not the error status\n        // is new, or the index was already in an error state.\n        continueWaiting = true;\n      } else if (initialStatus !== \"error\") {\n        // The index status has transitioned from non-error to error => abort\n        continueWaiting = new Error(\"index entered error status\");\n      } else {\n        // The index status started as an error and is still an error => allow a limited number of retries\n        // irrespective of the requested maxRetries.\n        if (retryCount > Math.min(maxRetries, pollingRetries)) {\n          continueWaiting = new Error(`index still in error status after ${retryCount} retries`);\n        } else {\n          continueWaiting = true;\n        }\n      }\n    } else {\n      continueWaiting = !!dataset && dataset.indexStatus === status;\n    }\n\n    // Cache the first index status we see.\n    if (dataset && !initialStatus) {\n      initialStatus = dataset.indexStatus;\n    }\n\n    return continueWaiting;\n  };\n\n  return waitForResource.call(this, datasetId, builtIndexCheck, 0, maxRetries);\n};\n\nexport {\n  buildCommandRequest,\n  buildDatabotHostRequest,\n  buildDatabotInstanceRequest,\n  buildQueryRequest,\n  checkResponse,\n  fetchWithDeadline,\n  handleError,\n  setDefaults,\n  TDXApiError,\n  waitForIndex,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/helpers.js","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"base-64\"\n// module id = 2\n// module chunks = 0","import base64 from \"base-64\";\nimport debug from \"debug\";\nimport {\n  buildCommandRequest,\n  buildDatabotHostRequest,\n  buildDatabotInstanceRequest,\n  buildQueryRequest,\n  checkResponse,\n  fetchWithDeadline as fetch,\n  handleError,\n  setDefaults,\n  waitForIndex,\n} from \"./helpers\";\n\nconst log = debug(\"nqm-api-tdx\");\nconst errLog = debug(\"nqm-api-tdx:error\");\n\n/**\n * @typedef  {object} CommandResult\n * @property  {string} commandId - The auto-generated unique id of the command.\n * @property  {object|string} response - The result of the command. If a command is sent asynchronously, this will\n * simply be the string `\"ack\"`. In synchronous mode, this will usually be an object consisting of the primary key\n * of the data that was affected by the command.\n */\n\n/**\n * @typedef  {object} DatasetData\n * @property  {object} metaData - The dataset metadata (see `nqmMeta` option in `getDatasetData`).\n * @property  {string} metaDataUrl - The URL to the dataset metadata (see `nqmMeta` option in `getDatasetData`.\n * @property  {object[]} data - The dataset documents.\n */\n\n/**\n * @typedef  {object} Resource\n * @property  {string} description\n * @property  {string} id\n * @property  {string} name\n * @property  {string[]} parents\n * @property  {object} schemaDefinition\n * @property  {string[]} tags\n */\n\n/**\n * @typedef  {object} Zone\n * @property  {string} accountType\n * @property  {string} displayName\n * @property  {string} username\n */\n\nclass TDXApi {\n  /**\n   * Create a TDXApi instance\n   * @param  {object} config - the TDX configuration for the remote TDX\n   * @param  {string} [config.tdxServer] - the URL of the TDX auth server, e.g. https://tdx.nqminds.com. Usually this\n   * is the only host parameter needed, as long as the target TDX conforms to the standard service naming conventions\n   * e.g. https://[service].[tdx-domain].com. In this case the individual service hosts can be derived from the tdxHost\n   * name. Optionally, you can specify each individual service host (see below). Note you only need to provide the host\n   * for services you intend to use. For example, if you only need query services, just provide the query host.\n   * @param  {string} [config.commandServer] - the URL of the TDX command service, e.g. https://cmd.nqminds.com\n   * @param  {string} [config.queryServer] - the URL of the TDX query service, e.g. https://q.nqminds.com\n   * @param  {string} [config.databotServer] - the URL of the TDX databot service, e.g. https://databot.nqminds.com\n   * @param  {string} [config.accessToken] - an access token that will be used to authorise commands and queries.\n   * Alternatively you can use the authenticate method to acquire a token.\n   * @example <caption>standard usage</caption>\n   * import TDXApi from \"nqm-api-tdx\";\n   * const api = new TDXApi({tdxServer: \"https://tdx.acme.com\"});\n   */\n  constructor(config) {\n    this.config = {...config};\n    this.accessToken = config.accessToken || \"\";\n    setDefaults(this.config);\n  }\n\n  /**\n   * Authenticates with the TDX, acquiring an authorisation token.\n   * @param  {string} id - the account id, or a pre-formed credentials string, e.g. \"DKJG8dfg:letmein\"\n   * @param  {string} secret - the account secret\n   * @param  {number} [ttl=3600] - the Time-To-Live of the token in seconds, default is 1 hour.\n   * @return  {string} The access token.\n   * @exception Will throw if credentials are invalid or there is a network error contacting the TDX.\n   * @example <caption>authenticate using a share key and secret</caption>\n   * tdxApi.authenticate(\"DKJG8dfg\", \"letmein\");\n   * @example <caption>authenticate using custom ttl of 2 hours</caption>\n   * tdxApi.authenticate(\"DKJG8dfg\", \"letmein\", 7200);\n   */\n  authenticate(id, secret, ttl, ip) {\n    let credentials;\n\n    if (typeof secret !== \"string\") {\n      // Assume the first argument is a pre-formed credentials string\n      credentials = id;\n      ttl = secret;\n    } else {\n      // uri-encode the username and concatenate with secret.\n      credentials = `${encodeURIComponent(id)}:${secret}`;\n    }\n\n    // Authorization headers must be base-64 encoded.\n    credentials = base64.encode(credentials);\n\n    // We can get a token from any of the TDX services - use the first one we find to build a fetch Request.\n    const uri = `${this.config.tdxServer || this.config.commandServer || this.config.queryServer}/token`;\n    const request = new Request(uri, {\n      method: \"POST\",\n      mode: \"cors\",\n      headers: new Headers({\n        \"Authorization\": `Basic ${credentials}`,\n        \"Content-Type\": \"application/json\",\n      }),\n      body: JSON.stringify({grant_type: \"client_credentials\", ip, ttl: ttl || this.config.accessTokenTTL || 3600}),\n    });\n\n    return fetch.call(this, request)\n      .then(checkResponse.bind(null, \"authenticate\"))\n      .then((result) => {\n        log(result);\n        this.accessToken = result.access_token;\n        return this.accessToken;\n      })\n      .catch((err) => {\n        errLog(`authenticate error: ${err.message}`);\n        return Promise.reject(err);\n      });\n  }\n\n  /*\n   *\n   *  ACCOUNT COMMANDS\n   *\n   */\n\n  /**\n   * Adds an account to the TDX. An account can be an e-mail based user account, a share key (token) account,\n   * a databot host, an application, or an account-set (user group).\n   * @param  {object} options - new account options\n   * @param  {string} options.accountType - the type of account, one of [\"user\", \"token\"]\n   * @param  {bool} [options.approved] - account is pre-approved (reserved for system use only)\n   * @param  {string} [options.authService] - the authentication type, one of [\"local\", \"oauth:google\",\n   * \"oauth:github\"]. Required for user-based accounts. Ignored for non-user accounts.\n   * @param  {string} [options.displayName] - the human-friendly display name of the account, e.g. \"Toby's share key\"\n   * @param  {number} [options.expires] - a timestamp at which the account expires and will no longer be granted a\n   * token\n   * @param  {string} [options.key] - the account secret. Required for all but oauth-based account types.\n   * @param  {string} [options.owner] - the owner of the account.\n   * @param  {bool} [options.scratchAccess] - indicates this account can create resources in the owners scratch\n   * folder. Ignored for all accounts except share key (token) accounts. Is useful for databots that need to create\n   * intermediate or temporary resources without specifying a parent resource - if no parent resource is given\n   * when a resource is created and scratch access is enabled, the resource will be created in the owner's scratch\n   * folder.\n   * @param  {object} [options.settings] - free-form JSON object for user data.\n   * @param  {string} [options.username] - the username of the new account. Required for user-based accounts, and\n   * should be the account e-mail address. Can be omitted for non-user accounts, and will be auto-generated.\n   * @param  {bool} [options.verified] - account is pre-verified (reserved for system use only)\n   * @param  {string[]} [options.whitelist] - a list of IP addresses. Tokens will only be granted if the requesting\n   * IP address is in this list\n   * @return  {CommandResult}\n   */\n  addAccount(options) {\n    const request = buildCommandRequest.call(this, \"account/create\", options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.addAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"addAccount\"));\n  }\n\n  /**\n   * Set account approved status. Reserved for system use.\n   * @param  {string} username - the full TDX identity of the account.\n   * @param  {bool} approved - account approved status\n   */\n  approveAccount(username, approved) {\n    const request = buildCommandRequest.call(this, \"account/approve\", {username, approved});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.approveAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"approveAccount\"));\n  }\n\n  /**\n   * Delete an account\n   * @param  {string} username - the full TDX identity of the account to delete.\n   */\n  deleteAccount(username) {\n    const request = buildCommandRequest.call(this, \"account/delete\", {username});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteAccount\"));\n  }\n\n  /**\n   * Change account secret.\n   * @param  {string} username - the full TDX identity of the account.\n   * @param  {string} key - the new secret\n   */\n  resetAccount(username, key) {\n    const request = buildCommandRequest.call(this, \"account/reset\", {username, key});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.resetAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"resetAccount\"));\n  }\n\n  /**\n   * Updates account details. All update properties are optional. See createAccount for full details of\n   * each option.\n   * @param  {string} username - the full TDX identity of the account to update.\n   * @param  {object} options - the update options\n   * @param  {string} [options.displayName]\n   * @param  {string} [options.key]\n   * @param  {bool} [options.scratchAccess]\n   * @param  {object} [options.settings]\n   * @param  {string[]} [options.whitelist]\n   */\n  updateAccount(username, options) {\n    const request = buildCommandRequest.call(this, \"account/update\", {username, ...options});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.updateAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"addAccount\"));\n  }\n\n  /**\n   * Set account verified status. Reserved for system use.\n   * @param  {string} username - the full TDX identity of the account.\n   * @param  {bool} approved - account verified status\n   */\n  verifyAccount(username, verified) {\n    const request = buildCommandRequest.call(this, \"account/verify\", {username, verified});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.verifyAccount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"verifyAccount\"));\n  }\n\n  /*\n   *\n   *  RESOURCE COMMANDS\n   *\n   */\n\n  /**\n   * Adds a data exchange to the list of trusted exchanges known to the current TDX.\n   * @param  {object} options\n   * @param  {string} options.owner - the account on this TDX to which the trust relates,\n   * e.g. `bob@mail.com/tdx.acme.com`\n   * @param  {string} options.targetServer - the TDX to be trusted, e.g. `tdx.nqminds.com`\n   * @param  {string} options.targetOwner - the account on the target TDX that is trusted,\n   * e.g. `alice@mail.com/tdx.nqminds.com`.\n   */\n  addTrustedExchange(options) {\n    const request = buildCommandRequest.call(this, \"trustedConnection/create\", options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.addTrustedExchange: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"addTrustedExchange\"));\n  }\n\n  /**\n   * Adds a resource to the TDX.\n   * @param  {object} options - details of the resource to be added.\n   * @param  {string} [options.basedOnSchema=dataset] - the id of the schema on which this resource will be based.\n   * @param  {object} [options.derived] - definition of derived filter, implying this resource is a view on an existing\n   * dataset.\n   * @param  {object} [options.derived.filter] - the (read) filter to apply, in mongodb query format,\n   * e.g. `{\"temperature\": {\"$gt\": 15}}` will mean that only data with a temperature value greater than 15 will be\n   * available in this view. The filter can be any arbitrarily complex mongodb query. Use the placeholder\n   * `\"@@_identity_@@\"` to indicate that the identity of the currently authenticated user should be substituted.\n   * For example, if the user `bob@acme.com/tdx.acme.com` is currently authenticated, a filter of `{\"username\":\n   *  \"@@_identity_@@\"}` will resolve at runtime to `{\"username\": \"bob@acme.com/tdx.acme.com\"}`.\n   * @param  {object} [options.derived.projection] - the (read) projection to apply, in mongodb projection format,\n   * e.g. `{\"timestamp\": 1, \"temperature\": 1}` implies only the 'timestamp' and 'temperature' properties will be\n   * returned.\n   * @param  {string} [options.derived.source] - the id of the source dataset on which to apply the filters and\n   * projections.\n   * @param  {object} [options.derived.writeFilter] - the write filter to apply, in mongodb query format. This\n   * controls what data can be written to the underlying source dataset. For example, a write filter of\n   * `{\"temperature\": {\"$lt\": 40}}` means that attempts to write a temperature value greater than or equal to `40`\n   * will fail. The filter can be any arbitrarily complex mongodb query.\n   * @param  {object} [options.derived.writeProjection] - the write projection to apply, in mongodb projection format.\n   * This controls what properties can be written to the underlying dataset. For example, a write projection of\n   * `{\"temperature\": 1}` means that only the temperature field can be written, and attempts to write data to other\n   * properties will fail. To allow a view to create new data in the underlying dataset, the primary key fields\n   * must be included in the write projection.\n   * @param  {string} [options.description] - a description for the resource.\n   * @param  {string} [options.id] - the requested ID of the new resource. Must be unique. Will be auto-generated if\n   * omitted (recommended).\n   * @param  {string} options.name - the name of the resource. Must be unique in the parent folder.\n   * @param  {object} [options.meta] - a free-form object for storing metadata associated with this resource.\n   * @param  {string} [options.parentId] - the id of the parent resource. If omitted, will default to the appropriate\n   * root folder based on the type of resource being created.\n   * @param  {string} [options.provenance] - a description of the provenance of the resource. Markdown format is\n   * supported.\n   * @param  {object} [options.schema] - optional schema definition.\n   * @param  {string} [options.shareMode] - the share mode assigned to the new resource. One of [`\"pw\"`, `\"pr\"`,\n   * `\"tr\"`], corresponding to \"public read/write\", \"public read/trusted write\", \"trusted only\".\n   * @param  {string[]} [options.tags] - a list of tags to associate with the resource.\n   * @param  {bool} [wait=false] - indicates if the call should wait for the index to be built before it returns.\n   */\n  addResource(options, wait) {\n    const request = buildCommandRequest.call(this, \"resource/create\", options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.addResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"addResource\"))\n      .then((result) => {\n        if (wait) {\n          return waitForIndex.call(this, result.response.id)\n            .then(() => {\n              return result;\n            });\n        } else {\n          return result;\n        }\n      });\n  }\n\n  /**\n   * Adds read and/or write permission for an account to access a resource. Permission is required\n   * equivalent to that which is being added, e.g. adding write permission requires existing\n   * write access.\n   * @param  {string} resourceId - The resource id\n   * @param  {string} accountId - The account id to assign permission to\n   * @param  {string} sourceId - The id of the resource acting as the source of the access. This\n   * is usually the same as the target `resourceId`, but can also be a parent resource. For example,\n   * if write access is granted with the sourceId set to be a parent, then if the permission is\n   * revoked from the parent resource it will also be revoked from this resource.\n   * @param  {string[]} access - The access, one or more of [`\"r\"`, `\"w\"`]. Can be an array or an individual\n   * string.\n   * @example <caption>add access to an account</caption>\n   * tdxApi.addResourceAccess(myResourceId, \"bob@acme.com/tdx.acme.com\", myResourceId, [\"r\"]);\n   */\n  addResourceAccess(resourceId, accountId, sourceId, access) {\n    const request = buildCommandRequest.call(this, \"resourceAccess/add\", {\n      rid: resourceId,\n      aid: accountId,\n      src: sourceId,\n      acc: [].concat(access),\n    });\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.addResourceAccess: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"addResourceAccess\"));\n  }\n\n  /**\n   * Permanently deletes a resource.\n   * @param  {string} resourceId - the id of the resource to delete. Requires write permission\n   * to the resource.\n   */\n  deleteResource(resourceId) {\n    const request = buildCommandRequest.call(this, \"resource/delete\", {id: resourceId});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteResource\"));\n  }\n\n  /**\n   * Permanently deletes a list of resources.\n   * Will fail **all** deletes if any of the permission checks fail.\n   * @param  {string[]} resourceIdList - This list of resource ids to delete.\n   * @return  {CommandResult}\n   */\n  deleteManyResources(resourceIdList) {\n    const request = buildCommandRequest.call(this, \"resource/deleteMany\", {payload: resourceIdList});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteManyResources: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteManyResources\"));\n  }\n\n  /**\n   * Upload a file to a resource.\n   * @param  {string} resourceId - The id of the destination resource.\n   * @param  {object} file - The file to upload, obtained from an `<input type=\"file\">` element.\n   * @param  {bool} [stream=false] - Flag indicating whether the call should return a stream allowing\n   * callees to monitor progress.\n   */\n  fileUpload(resourceId, file, stream) {\n    const request = new Request(`${this.config.commandServer}/commandSync/resource/${resourceId}/upload`, {\n      method: \"POST\",\n      mode: \"cors\",\n      headers: new Headers({\n        \"Authorization\": `Bearer ${this.accessToken}`,\n        \"Content-Disposition\": `attachment; filename=\"${file.name}\"`,\n        \"Content-Length\": file.size,\n      }),\n      body: file,\n    });\n\n    const response = fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.fileUpload: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      });\n\n    if (stream) {\n      return response;\n    } else {\n      return response\n      .then((response) => {\n        return [response, response.text()];\n      })\n      .spread((response, text) => {\n        if (response.ok) {\n          return Promise.resolve(text);\n        } else {\n          return Promise.reject(handleError(\"fileUpload\", {code: \"failure\", message: text}));\n        }\n      });\n    }\n  }\n\n  /**\n   * Move resource from one folder to another. Requires write permission on the resource, the\n   * source parent and the target parent resources.\n   * @param  {string} id - the id of the resource to move.\n   * @param  {string} fromParentId - the current parent resource to move from.\n   * @param  {string} toParentId - the target folder resource to move to.\n   */\n  moveResource(id, fromParentId, toParentId) {\n    const request = buildCommandRequest.call(this, \"resource/move\", {id, fromParentId, toParentId});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.moveResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"moveResource\"));\n  }\n\n  /**\n   * Resets the resource index. This involves deleting existing indexes and rebuilding them. May take\n   * a while depending on the size of any associated dataset and the number and complexity of indexes.\n   * @param  {string} resourceId - the id of the resource, requires write permission.\n   */\n  rebuildResourceIndex(resourceId) {\n    const request = buildCommandRequest.call(this, \"resource/index/rebuild\", {id: resourceId});\n    let result;\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.rebuildResourceIndex: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"rebuildIndex\"))\n      .then((res) => {\n        result = res;\n        return waitForIndex.call(this, result.response.id, \"built\");\n      })\n      .then(() => {\n        return result;\n      });\n  }\n\n  /**\n   * Removes access for an account to a resource. Permission is required\n   * equivalent to that which is being added, e.g. adding write permission requires existing\n   * write access.\n   * @param  {string} resourceId - The resource id.\n   * @param  {string} accountId - The account id to remove access from.\n   * @param  {string} addedBy - The account id that originally added the access, probably your\n   * account id.\n   * @param  {string} sourceId - The source of the access, usually the resource itself.\n   * @param  {string[]} access - The access, one or more of [`\"r\"`, `\"w\"`].\n   */\n  removeResourceAccess(resourceId, accountId, addedBy, sourceId, access) {\n    const request = buildCommandRequest.call(this, \"resourceAccess/delete\", {\n      rid: resourceId,\n      aid: accountId,\n      by: addedBy,\n      src: sourceId,\n      acc: access,\n    });\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.removeResourceAccess: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"removeResourceAccess\"));\n  }\n\n  /**\n   * Set the resource schema.\n   * @param  {string} resourceId - The id of the dataset-based resource.\n   * @param  {object} schema - The new schema definition. TODO - document\n   * @return  {CommandResult}\n   */\n  setResourceSchema(resourceId, schema) {\n    const request = buildCommandRequest.call(this, \"resource/schema/set\", {id: resourceId, schema});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.setResourceSchema: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"setResourceSchema\"));\n  }\n\n  /**\n   * Set the share mode for a resource.\n   * @param  {string} resourceId - The resource id.\n   * @param  {string} shareMode - The share mode to set, one or [`\"pw\"`, `\"pr\"`, `\"tr\"`] corresponding to\n   * 'public read/write', 'public read, trusted write', 'trusted only'.\n   */\n  setResourceShareMode(resourceId, shareMode) {\n    const request = buildCommandRequest.call(this, \"resource/setShareMode\", {id: resourceId, shareMode});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.setResourceShareMode: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"setResourceShareMode\"));\n  }\n\n  /**\n   * Sets the permissive share mode of the resource. Permissive share allows anybody with acces to the resource\n   * to share it with others. If a resource is not in permissive share mode, only the resource owner\n   * can share it with others.\n   * @param  {string} resourceId - The resource id.\n   * @param  {bool} allowPermissive - The required permissive share mode.\n   */\n  setResourcePermissiveShare(resourceId, allowPermissive) {\n    const request = buildCommandRequest.call(this, \"resource/setPermissiveShare\", {\n      id: resourceId,\n      permissiveShare: allowPermissive ? \"r\" : \"\",\n    });\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.setResourcePermissiveShare: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"setResourcePermissiveShare\"));\n  }\n\n  /**\n   * Suspends the resource index. This involves deleting any existing indexes. Requires write permission. When\n   * a resource index is in `suspended` status, it is not possible to run any queries or updates against\n   * the resource.\n   * @param  {string} resourceId - the id of the resource. Requires write permission.\n   */\n  suspendResourceIndex(resourceId) {\n    const request = buildCommandRequest.call(this, \"resource/index/suspend\", {id: resourceId});\n    let result;\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.suspendResourceIndex: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"suspendIndex\"))\n      .then((res) => {\n        result = res;\n        return waitForIndex.call(this, result.response.id, \"suspended\");\n      })\n      .then(() => {\n        return result;\n      });\n  }\n\n  /**\n   * Removes all data from the resource. Applicable to dataset-based resources only. This can not be\n   * undone.\n   * @param  {string} resourceId - The resource id to truncate.\n   */\n  truncateResource(resourceId) {\n    const request = buildCommandRequest.call(this, \"resource/truncate\", {id: resourceId});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.truncateResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"truncateResource\"));\n  }\n\n  /**\n   * Modify one or more of the meta data associated with the resource.\n   * @param  {string} resourceId - id of the resource to update\n   * @param  {object} update - object containing the properties to update. Can be one or more of those\n   * listed below. See the {@link TDXApi#addResource} method for semantics and syntax of each property.\n   * @param  {string} [update.derived]\n   * @param  {string} [update.description]\n   * @param  {string} [update.meta]\n   * @param  {string} [update.name]\n   * @param  {string} [update.provenance]\n   * @param  {string} [update.schema]\n   * @param  {string} [update.tags]\n   */\n  updateResource(resourceId, update) {\n    const request = buildCommandRequest.call(this, \"resource/update\", {id: resourceId, ...update});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.updateResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"updateResource\"));\n  }\n\n  /*\n   *\n   *  RESOURCE DATA COMMANDS\n   *\n   */\n\n   /**\n   * Add data to a dataset resource.\n   * @param  {string} datasetId - The id of the dataset-based resource to add data to.\n   * @param  {object|array} data - The data to add. Must conform to the schema defined by the resource metadata.\n   * Supports creating an individual document or many documents.\n   * @example <caption>create an individual document</caption>\n   * // Assumes the dataset primary key is 'lsoa'\n   * tdxApi.addData(myDatasetId, {lsoa: \"E0000001\", count: 398});\n   * @example <caption>create multiple documents</caption>\n   * tdxApi.addData(myDatasetId, [\n   *  {lsoa: \"E0000001\", count: 398},\n   *  {lsoa: \"E0000002\", count: 1775},\n   *  {lsoa: \"E0000005\", count: 4533},\n   * ]);\n   */\n  addData(datasetId, data) {\n    const postData = {\n      datasetId,\n      payload: [].concat(data),\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/createMany\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.createData: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"updateData\"));\n  }\n\n  /**\n   * Deletes data from a dataset-based resource.\n   * @param  {string} datasetId - The id of the dataset-based resource to delete data from.\n   * @param  {object|array} data - The primary key data to delete.\n   */\n  deleteData(datasetId, data) {\n    const postData = {\n      datasetId,\n      payload: [].concat(data),\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/deleteMany\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteData: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteData\"));\n  }\n\n  /**\n   * Deletes data from a dataset-based resource using a query to specify the documents to be deleted.\n   * @param  {string} datasetId - The id of the dataset-based resource to delete data from.\n   * @param  {object} query - The query that specifies the data to delete. All documents matching the\n   * query will be deleted.\n   * @example\n   * // Delete all documents with English lsoa.\n   * tdxApi.deleteDataByQuery(myDatasetId, {lsoa: {$regex: \"E*\"}});\n   */\n  deleteDataByQuery(datasetId, query) {\n    const postData = {\n      datasetId,\n      query,\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/deleteQuery\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteDataByQuery: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteDataByQuery\"));\n  }\n\n  /**\n   * Patches data in a dataset resource. Uses the [JSON patch](https://tools.ietf.org/html/rfc6902) format,\n   * which involves defining the primary key data followed by a flexible update specification.\n   * @param  {string} datasetId - The id of the dataset-based resource to update.\n   * @param  {object} data - The patch definition.\n   * @param  {object|array} data.__update - An array of JSON patch specifications.\n   * @example <caption>patch a single value in a single document</caption>\n   * tdxApi.patchData(myDatasetId, {lsoa: \"E000001\", __update: [{p: \"count\", m: \"r\", v: 948}]});\n   * @example <caption>patch a more than one value in a single document</caption>\n   * tdxApi.patchData(myDatasetId, {lsoa: \"E000001\", __update: [\n   *   {p: \"count\", m: \"r\", v: 948}\n   *   {p: \"modified\", m: \"a\", v: Date.now()}\n   * ]});\n   */\n  patchData(datasetId, data) {\n    const postData = {\n      datasetId,\n      payload: [].concat(data),\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/upsertMany\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.patchData: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"patchData\"));\n  }\n\n  /**\n   * Updates data in a dataset resource.\n   * @param  {string} datasetId - The id of the dataset-based resource to update.\n   * @param  {object|array} data - The data to update. Must conform to the schema defined by the resource metadata.\n   * Supports updating individual or multiple documents.\n   * @param  {bool} [upsert=false] - Indicates the data should be created if no document is found matching the\n   * primary key.\n   * @example <caption>update an existing document</caption>\n   * tdxApi.updateData(myDatasetId, {lsoa: \"E000001\", count: 488});\n   * @example <caption>upsert a document</caption>\n   * // Will create a document if no data exists matching key 'lsoa': \"E000004\"\n   * tdxApi.updateData(myDatasetId, {lsoa: \"E000004\", count: 288, true});\n   */\n  updateData(datasetId, data, upsert) {\n    const postData = {\n      datasetId,\n      payload: [].concat(data),\n      __upsert: !!upsert,\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/updateMany\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.updateData: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"updateData\"));\n  }\n\n  /**\n   * Updates data in a dataset-based resource using a query to specify the documents to be updated.\n   * @param  {string} datasetId - The id of the dataset-based resource to update data in.\n   * @param  {object} query - The query that specifies the data to update. All documents matching the\n   * query will be updated.\n   * @example\n   * // Update all documents with English lsoa.\n   * tdxApi.deleteDataByQuery(myDatasetId, {lsoa: {$regex: \"E*\"}}, {count: 1000});\n   */\n  updateDataByQuery(datasetId, query, update) {\n    const postData = {\n      datasetId,\n      query,\n      update,\n    };\n    const request = buildCommandRequest.call(this, \"dataset/data/updateQuery\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.updateDataByQuery: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"updateDataByQuery\"));\n  }\n\n  /*\n   *\n   *  DATABOT COMMANDS\n   *\n   */\n\n  /**\n   * Deletes one or more hosts, depending on the given parameters. E.g. if just a `hostId` is given, all hosts\n   * will be deleted with that id. If an ip address is also given, all hosts with the id on that ip address will\n   * be deleted and so on. Note that hosts can only be deleted if they are in the `offline` status.\n   * @param  {object} payload - The definition of the host(s) to delete. Can be an array of objects or a single object\n   * @param  {string} payload.hostId - The id of the hosts to be deleted.\n   * @param  {string} [payload.hostIp] - The optional ip of the hosts to be deleted.\n   * @param  {number} [payload.hostPort] - The optional port number of the host to be deleted.\n   */\n  deleteDatabotHost(payload) {\n    const postData = {\n      payload,\n    };\n    const request = buildCommandRequest.call(this, \"databot/host/delete\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteDatabotHost: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteDatabotHost\"));\n  }\n\n  /**\n   * Deletes a databot instance and all output/debug data associated with it.\n   * @param  {string[]} instanceId - The id(s) of the instances to delete. Can be an array of instance ids or an\n   * individual string id\n   */\n  deleteDatabotInstance(instanceId) {\n    const postData = {\n      instanceId: [].concat(instanceId),\n    };\n    const request = buildCommandRequest.call(this, \"databot/deleteInstance\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.deleteDatabotInstance: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"deleteDatabotInstance\"));\n  }\n\n  /**\n   * Gets databot instance data for the given instance id.\n   * @param  {string} instanceId - The id of the instance to retrieve.\n   */\n  getDatabotInstance(instanceId) {\n    const request = buildDatabotInstanceRequest.call(this, instanceId);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatabotInstance: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getDatabotInstance\"));\n  }\n\n  /**\n   * Get databot instance output.\n   * @param  {string} instanceId - The instance id to retrieve output for.\n   * @param  {string} [processId] - Optional process id. If omitted, output for all instance processes will be returned.\n   */\n  getDatabotInstanceOutput(instanceId, processId) {\n    const request = buildDatabotInstanceRequest.call(this, `output/${instanceId}/${processId || \"\"}`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatabotInstanceOutput: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getDatabotInstanceOutput\"));\n  }\n\n  /**\n   * Get databot instance status.\n   * @param  {string} instanceId - The id of the databot instance for which status is retrieved.\n   */\n  getDatabotInstanceStatus(instanceId) {\n    const request = buildDatabotInstanceRequest.call(this, `status/${instanceId}`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatabotInstanceStatus: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getDatabotInstanceStatus\"));\n  }\n\n  /**\n   * Registers a databot host as active with the TDX.\n   * @param  {object} status - The databot host identifier payload.\n   */\n  registerDatabotHost(status) {\n    const request = buildDatabotHostRequest.call(this, \"register\", status);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.registerDatabotHost: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"registerDatabotHost\"));\n  }\n\n  /**\n   * Sends a command to a databot host. Reserved for system use.\n   * @param  {string} command - The command to send. Must be one of [\"stopHost\", \"updateHost\", \"runInstance\",\n   * \"stopInstance\", \"clearInstance\"]\n   * @param  {string} hostId - The id of the host.\n   * @param  {string} [hostIp] - The ip address of the host. If omitted, the command will be sent to all\n   * host ip addresses.\n   * @param  {number} [hostPort] - The port number of the host. If omitted, the command will be sent to\n   * all host ports.\n   */\n  sendDatabotHostCommand(command, hostId, hostIp, hostPort) {\n    const postData = {\n      hostId,\n      hostIp,\n      hostPort,\n      command,\n    };\n    const request = buildCommandRequest.call(this, \"databot/host/command\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.sendDatabotHostCommand: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"sendDatabotHostCommand\"));\n  }\n\n  /**\n   * Starts a databot instance.\n   * @param  {string} databotId - The id of the databot definition to start.\n   * @param  {object} payload - The instance input and parameters.\n   * @param  {number} [payload.authTokenTTL] - The time-to-live to use when creating the auth token, in seconds.\n   * Will default to the TDX-configured default if not given (usually 1 hour).\n   * @param  {number} [payload.chunks=1] - The number of processes to instantiate. Each will be given the same input\n   * data, with only the chunk number varying.\n   * @param  {bool} [payload.debugMode=false] - Flag indicating this instance should be run in debug mode, meaning\n   * all debug output will be captured and stored on the TDX. n.b. setting this will also restrict the hosts available\n   * to run the instance to those that are willing to run in debug mode.\n   * @param  {string} [payload.description] - The description for this instance.\n   * @param  {object} [payload.inputs] - The input data. A free-form object that should conform to the\n   * specification in the associated databot definition.\n   * @param  {string} [payload.name] - The name to associate with this instance, e.g. \"Male population\n   * projection 2017\"\n   * @param  {string} [payload.overwriteExisting] - The id of an existing instance that should be overwritten.\n   * @param  {number} [payload.priority] - The priority to assign this instance. Reserved for system use.\n   * @param  {string} payload.shareKeyId - The share key to run the databot under.\n   * @param  {string} [payload.shareKeySecret] - The secret of the share key. Ignored if the share key id refers to a\n   * user-based account.\n   */\n  startDatabotInstance(databotId, payload) {\n    const postData = {\n      databotId,\n      instanceData: payload,\n    };\n    const request = buildCommandRequest.call(this, \"databot/startInstance\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.startDatabotInstance: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"startDatabotInstance\"));\n  }\n\n  /**\n   * Terminates or pauses a running databot instance.\n   * @param  {string} instanceId - The id of the instance to terminate or pause.\n   * @param  {string} mode - One of [`\"stop\"`, `\"pause\"`, `\"resume\"`]\n   */\n  stopDatabotInstance(instanceId, mode) {\n    const postData = {\n      instanceId,\n      mode,\n    };\n    const request = buildCommandRequest.call(this, \"databot/stopInstance\", postData);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.stopDatabotInstance: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"stopDatabotInstance\"));\n  }\n\n  /**\n   * Updates a databot host status.\n   * @param  {object} status - The databot host status payload.\n   */\n  updateDatabotHostStatus(status) {\n    const request = buildDatabotHostRequest.call(this, \"status\", status);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.updateDatabotHostStatus: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"updateDatabotHostStatus\"));\n  }\n\n  /**\n   * Stores databot instance output on the TDX.\n   * @param  {object} output - The output payload for the databot instance.\n   */\n  writeDatabotHostInstanceOutput(output) {\n    const request = buildDatabotHostRequest.call(this, \"output\", output);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.writeDatabotHostInstanceOutput: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"writeDatabotHostInstanceOutput\"));\n  }\n\n  /*\n   *\n   *  QUERIES\n   *\n   */\n\n  /**\n   * Streams the contents of a resource. For dataset-based resources this will stream the dataset contents in newline\n   * delimited JSON (NDJSON). For raw file resources this will stream the raw file contents (zip, raw JSON etc).\n   * @param  {string} resourceId - The id of the resource to be downloaded.\n   * @return {object} - Response object, where the response body is a stream object.\n   */\n  downloadResource(resourceId) {\n    const request = buildQueryRequest.call(this, `resource/${resourceId}`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.downloadResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      });\n  }\n\n  /**\n   * Performs an aggregate query on the given dataset, returning a response object with stream in the body\n   * @param  {string} datasetId - The id of the dataset-based resource to perform the aggregate query on.\n   * @param  {object|string} pipeline - The aggregate pipeline, as defined in the\n   * [mongodb docs](https://docs.mongodb.com/manual/aggregation/). Can be given as a JSON object or as a stringified\n   * JSON object.\n   * @return  {object} - Response object, where the response body is a stream object.\n   */\n  getAggregateDataStream(datasetId, pipeline) {\n    // Convert pipeline to string if necessary.\n    if (pipeline && typeof pipeline === \"object\") {\n      pipeline = JSON.stringify(pipeline);\n    }\n    const request = buildQueryRequest.call(this, `datasets/${datasetId}/aggregate?pipeline=${pipeline}`);\n    return fetch.call(this, request)\n    .catch((err) => {\n      errLog(\"TDXApi.getAggregateData: %s\", err.message);\n      return Promise.reject(new Error(`${err.message} - [network error]`));\n    });\n  }\n\n  /**\n   * Performs an aggregate query on the given dataset.\n   * @param  {string} datasetId - The id of the dataset-based resource to perform the aggregate query on.\n   * @param  {object|string} pipeline - The aggregate pipeline, as defined in the\n   * [mongodb docs](https://docs.mongodb.com/manual/aggregation/). Can be given as a JSON object or as a stringified\n   * JSON object.\n   * @return  {DatasetData}\n   */\n  getAggregateData(datasetId, pipeline) {\n    return this.getAggregateDataStream(datasetId, pipeline)\n      .then(checkResponse.bind(null, \"getAggregateData\"));\n  }\n\n  /**\n   * Gets all data from the given dataset that matches the filter provided and returns a response object with stream\n   * in the body.\n   * @param  {string} datasetId - The id of the dataset-based resource.\n   * @param  {object} [filter] - A mongodb filter object. If omitted, all data will be retrieved.\n   * @param  {object} [projection] - A mongodb projection object. Should be used to restrict the payload to the\n   * minimum properties needed if a lot of data is being retrieved.\n   * @param  {object} [options] - A mongodb options object. Can be used to limit, skip, sort etc. Note a default\n   * `limit` of 1000 is applied if none is given here.\n   * @param  {bool} [options.nqmMeta] - When set, the resource metadata will be returned along with the dataset\n   * data. Can be used to avoid a second call to `getResource`. Otherwise a URL to the metadata is provided.\n   * @return  {object} - Response object, where the response body is a stream object.\n   */\n  getDatasetDataStream(datasetId, filter, projection, options) {\n    const request = buildQueryRequest.call(this, `datasets/${datasetId}/data`, filter, projection, options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatasetDataStream: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      });\n  }\n\n  /**\n   * Gets all data from the given dataset that matches the filter provided.\n   * @param  {string} datasetId - The id of the dataset-based resource.\n   * @param  {object} [filter] - A mongodb filter object. If omitted, all data will be retrieved.\n   * @param  {object} [projection] - A mongodb projection object. Should be used to restrict the payload to the\n   * minimum properties needed if a lot of data is being retrieved.\n   * @param  {object} [options] - A mongodb options object. Can be used to limit, skip, sort etc. Note a default\n   * `limit` of 1000 is applied if none is given here.\n   * @param  {bool} [options.nqmMeta] - When set, the resource metadata will be returned along with the dataset\n   * data. Can be used to avoid a second call to `getResource`. Otherwise a URL to the metadata is provided.\n   * @return  {DatasetData}\n   */\n  getDatasetData(datasetId, filter, projection, options) {\n    return this.getDatasetDataStream(datasetId, filter, projection, options)\n      .then(checkResponse.bind(null, \"getDatasetData\"));\n  }\n\n  /**\n   * Gets a count of the data in a dataset-based resource, after applying the given filter.\n   * @param  {string} datasetId - The id of the dataset-based resource.\n   * @param  {object} [filter] - An optional mongodb filter to apply before counting the data.\n   */\n  getDatasetDataCount(datasetId, filter) {\n    const request = buildQueryRequest.call(this, `datasets/${datasetId}/count`, filter);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatasetDataCount: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getDatasetDataCount\"));\n  }\n\n  /**\n   * Gets a list of distinct values for a given property in a dataset-based resource.\n   * @param  {string} datasetId - The id of the dataset-based resource.\n   * @param  {string} key - The name of the property to use. Can be a property path, e.g. `\"address.postcode\"`.\n   * @param  {object} [filter] - An optional mongodb filter to apply.\n   * @return  {object[]} - The distinct values.\n   */\n  getDistinct(datasetId, key, filter, projection, options) {\n    const request = buildQueryRequest.call(this, `datasets/${datasetId}/distinct?key=${key}`, filter, projection, options); // eslint-disable-line max-len\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDistinct: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getDistinct\"));\n  }\n\n  /**\n   * Gets the details for a given resource id.\n   * @param  {string} resourceId - The id of the resource to retrieve.\n   * @param  {bool} [noThrow=false] - If set, the call won't reject or throw if the resource doesn't exist.\n   * @return  {Resource}\n   * @exception  Will throw if the resource is not found (see `noThrow` flag) or permission is denied.\n   */\n  getResource(resourceId, noThrow) {\n    const request = buildQueryRequest.call(this, `resources/${resourceId}`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then((response) => {\n        if (noThrow) {\n          // If noThrow specified, return null if there is an error fetching the resource, rather than throwing.\n          if (response.ok) {\n            return response.json();\n          } else if (response.status === 404) {\n            return null;\n          } else {\n            return checkResponse(\"getResource\", response);\n          }\n        } else {\n          return checkResponse(\"getResource\", response);\n        }\n      });\n  }\n\n  /**\n   * Gets all access the authenticated account has to the given resource id.\n   * @param  {string} resourceId - The id of the resource whose access is to be retrieved.\n   * @return {object[]} - Array of access objects.\n   */\n  getResourceAccess(resourceId, filter, projection, options) {\n    const request = buildQueryRequest.call(this, `resources/${resourceId}/access`, filter, projection, options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getResourceAccess: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then((response) => {\n        return checkResponse(\"getResourceAccess\", response);\n      });\n  }\n\n  /**\n   * Gets all resources that are ancestors of the given resource.\n   * @param  {string} resourceId - The id of the resource whose parents are to be retrieved.\n   * @return  {Resource[]}\n   */\n  getResourceAncestors(resourceId) {\n    const request = buildQueryRequest.call(this, `datasets/${resourceId}/ancestors`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getDatasetAncestors: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getResourceAncestors\"));\n  }\n\n  /**\n   * Gets the details of all resources that match the given filter.\n   * @param  {object} [filter] - A mongodb filter definition\n   * @param  {object} [projection] - A mongodb projection definition, can be used to restrict which properties are\n   * returned thereby limiting the payload.\n   * @param  {object} [options] - A mongodb options definition, can be used for limit, skip, sorting etc.\n   * @return  {Resource[]}\n   */\n  getResources(filter, projection, options) {\n    const request = buildQueryRequest.call(this, \"resources\", filter, projection, options);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getResource: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getResources\"));\n  }\n\n  /**\n   * Retrieves all resources that have an immediate ancestor of the given schema id.\n   * @param  {string} schemaId - The id of the schema to match, e.g. `\"geojson\"`.\n   * @return  {Resource[]}\n   */\n  getResourcesWithSchema(schemaId) {\n    const filter = {\"schemaDefinition.parent\": schemaId};\n    return this.getResources(filter);\n  }\n\n  /**\n   * Retrieves an authorisation token for the given TDX instance\n   * @param  {string} tdx - The TDX instance name, e.g. `\"tdx.acme.com\"`.\n   * @return  {string}\n   */\n  getTDXToken(tdx) {\n    const request = buildQueryRequest.call(this, `tdx-token/${tdx}`);\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getTDXToken: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getTDXToken\"));\n  }\n\n  /**\n   * Gets the details for a given zone (account) id.\n   * @param  {string} accountId - the id of the zone to be retrieved.\n   * @return  {Zone} zone\n   */\n  getZone(accountId) {\n    const request = buildQueryRequest.call(this, \"zones\", {username: accountId});\n    return fetch.call(this, request)\n      .catch((err) => {\n        errLog(\"TDXApi.getZone: %s\", err.message);\n        return Promise.reject(new Error(`${err.message} - [network error]`));\n      })\n      .then(checkResponse.bind(null, \"getZone\"));\n  }\n}\n\nexport default TDXApi;\n\n\n\n// WEBPACK FOOTER //\n// ./src/api-tdx.js","module.exports = __WEBPACK_EXTERNAL_MODULE_4__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@nqminds/isomorphic-fetch\"\n// module id = 4\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_5__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 5\n// module chunks = 0"],"sourceRoot":""}