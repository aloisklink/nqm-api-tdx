!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("debug"),require("base-64"),require("@nqminds/isomorphic-fetch"),require("bluebird")):"function"==typeof define&&define.amd?define("nqm-api-tdx",["debug","base-64","@nqminds/isomorphic-fetch","bluebird"],t):"object"==typeof exports?exports["nqm-api-tdx"]=t(require("debug"),require("base-64"),require("@nqminds/isomorphic-fetch"),require("bluebird")):e["nqm-api-tdx"]=t(e.debug,e["base-64"],e["@nqminds/isomorphic-fetch"],e.bluebird)}(this,function(e,t,r,n){return function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(t,r){t.exports=e},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.waitForIndex=t.TDXApiError=t.setDefaults=t.handleError=t.fetchWithDeadline=t.checkResponse=t.buildQueryRequest=t.buildDatabotInstanceRequest=t.buildDatabotHostRequest=t.buildCommandRequest=void 0;var a=r(0),s=n(a),o=r(5),c=n(o),i=r(4),u=n(i);u.default.Promise=c.default;var l=function(e){var t=this,r=(0,s.default)("nqm-api-tdx:fetchWithDeadline");return new c.default(function(n,a){var s=setTimeout(function(){r("deadline expired after %d ms",t.config.networkTimeout),a(new Error("deadline expired after "+t.config.networkTimeout+" ms"))},t.config.networkTimeout);(0,u.default)(e).then(function(e){clearTimeout(s),n(e)},a)})},d=function(e,t){this.name="TDXApiError",this.message=e||"no message given",this.stack=t||(new Error).stack};d.prototype=Object.create(Error.prototype),d.prototype.constructor=d;var h=function(e,t,r){var n={from:e,failure:JSON.stringify(t),code:void 0===r?"n/a":r};return new d(JSON.stringify(n),(new Error).stack)},m=function(e,t,r,n){var a=n?"command":"commandSync";return r=r||"application/json",new Request(this.config.commandServer+"/"+a+"/"+e,{method:"POST",mode:"cors",headers:new Headers({Authorization:"Bearer "+this.accessToken,"Content-Type":r}),body:JSON.stringify(t)})},f=function(e,t){return new Request(this.config.databotServer+"/host/"+e,{method:"POST",mode:"cors",headers:new Headers({Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"}),body:JSON.stringify(t)})},p=function(e,t,r,n){t=t?JSON.stringify(t):"",r=r?JSON.stringify(r):"",n=n?JSON.stringify(n):"";var a=void 0;return a=e.indexOf("?")<0?e+"?filter="+t+"&proj="+r+"&opts="+n:e+"&filter="+t+"&proj="+r+"&opts="+n,new Request(""+this.config.queryServer+a,{method:"GET",mode:"cors",headers:new Headers({Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"})})},g=function(e){return new Request(this.config.databotServer+"/instance/"+e,{method:"GET",mode:"cors",headers:new Headers({Authorization:"Bearer "+this.accessToken,"Content-Type":"application/json"})})},v=function(e,t){return t.json().then(function(r){if(t.ok)return c.default.resolve(r);if(r.error){var n={code:r.error,message:r.error_description};return c.default.reject(h(e,n,t.status))}return c.default.reject(h(e,r,t.status))})},b=function(e){var t=(0,s.default)("nqm-api-tdx:setDefaults");if(e.tdxServer=e.tdxServer||e.tdxHost,e.commandServer=e.commandServer||e.commandHost,e.databotServer=e.databotServer||e.databotHost,e.queryServer=e.queryServer||e.queryHost,e.tdxServer&&(!e.queryServer||!e.commandServer)){var r=e.tdxServer.split("://");if(2!==r.length)throw new Error("invalid tdxServer in config - no protocol: "+e.tdxServer);var n=r[0],a=r[1].split(".");if(a.length<3)throw new Error("invalid tdxServer in config - expected sub.domain.tld: "+e.tdxServer);var o=a.slice(1).join(".");e.databotServer=e.databotServer||n+"://databot."+o,e.commandServer=e.commandServer||n+"://cmd."+o,e.queryServer=e.queryServer||n+"://q."+o}e.queryServer=e.queryServer&&e.queryServer+"/v1/",t("using hosts: command %s, databot %s, query %s, auth %s",e.commandServer||"[n/a]",e.databotServer||"[n/a]",e.queryServer||"[n/a]",e.tdxServer||"[n/a]"),e.networkTimeout=e.networkTimeout||12e4},D=function e(t,r,n,a){var o=this,i=(0,s.default)("nqm-api-tdx:waitForResource");return n=n||0,this.getResource(t).then(function(s){var u=r(s,n);return u instanceof Error?(i("waitForResource - check failed with error [%s]",u.message),c.default.reject(u)):u?s:a>=0&&n>a?(i("giving up after %d attempts",n),c.default.reject(new Error("gave up waiting for "+t+" after "+n+" attempts"))):(i("waiting for %d msec",1e3),new c.default(function(s){setTimeout(function(){i("trying again"),s(e.call(o,t,r,n+1,a))},1e3)}))}).catch(function(s){if("TDXApiError"!==s.name)return c.default.reject(s);try{var u=JSON.parse(s.message),l=JSON.parse(u.failure);return"NotFound"===l.code||"NotFoundError"===l.code||"Unauthorized"===l.code||"UnauthorizedError"===l.code?(i("ignoring error %s",s.message),new c.default(function(s){setTimeout(function(){s(e.call(o,t,r,n+1,a))},1e3)})):c.default.reject(s)}catch(e){return i("failure: [%s]",e.message),c.default.reject(s)}})},k=function(e,t,r){var n=(0,s.default)("nqm-api-tdx:waitForIndex");void 0===r&&(r=-1),t=t||"built";var a="";return D.call(this,e,function(e,s){n("builtIndexCheck: %s",e?e.indexStatus:"no dataset");var o=void 0;return o=e&&"error"===e.indexStatus?!a||("error"!==a?new Error("index entered error status"):!(s>Math.min(r,15))||new Error("index still in error status after "+s+" retries")):!!e&&e.indexStatus===t,e&&!a&&(a=e.indexStatus),o},0,r)};t.buildCommandRequest=m,t.buildDatabotHostRequest=f,t.buildDatabotInstanceRequest=g,t.buildQueryRequest=p,t.checkResponse=v,t.fetchWithDeadline=l,t.handleError=h,t.setDefaults=b,t.TDXApiError=d,t.waitForIndex=k},function(e,r){e.exports=t},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),u=n(i),l=r(0),d=n(l),h=r(1),m=(0,d.default)("nqm-api-tdx"),f=(0,d.default)("nqm-api-tdx:error"),p=function(){function e(t){a(this,e),this.config=o({},t),this.accessToken=t.accessToken||"",(0,h.setDefaults)(this.config)}return c(e,[{key:"authenticate",value:function(e,t,r,n){var a=this,s=void 0;"string"!=typeof t?(s=e,r=t):s=encodeURIComponent(e)+":"+t,s=u.default.encode(s);var o=(this.config.tdxServer||this.config.commandServer||this.config.queryServer)+"/token",c=new Request(o,{method:"POST",mode:"cors",headers:new Headers({Authorization:"Basic "+s,"Content-Type":"application/json"}),body:JSON.stringify({grant_type:"client_credentials",ip:n,ttl:r||this.config.accessTokenTTL||3600})});return h.fetchWithDeadline.call(this,c).then(h.checkResponse.bind(null,"authenticate")).then(function(e){return m(e),a.accessToken=e.access_token,a.accessToken}).catch(function(e){return f("authenticate error: "+e.message),Promise.reject(e)})}},{key:"addAccount",value:function(e){var t=h.buildCommandRequest.call(this,"account/create",e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.addAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"addAccount"))}},{key:"approveAccount",value:function(e,t){var r=h.buildCommandRequest.call(this,"account/approve",{username:e,approved:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.approveAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"approveAccount"))}},{key:"deleteAccount",value:function(e){var t=h.buildCommandRequest.call(this,"account/delete",{username:e});return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.deleteAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteAccount"))}},{key:"resetAccount",value:function(e,t){var r=h.buildCommandRequest.call(this,"account/reset",{username:e,key:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.resetAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"resetAccount"))}},{key:"updateAccount",value:function(e,t){var r=h.buildCommandRequest.call(this,"account/update",o({username:e},t));return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.updateAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"addAccount"))}},{key:"verifyAccount",value:function(e,t){var r=h.buildCommandRequest.call(this,"account/verify",{username:e,verified:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.verifyAccount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"verifyAccount"))}},{key:"addTrustedExchange",value:function(e){var t=h.buildCommandRequest.call(this,"trustedConnection/create",e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.addTrustedExchange: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"addTrustedExchange"))}},{key:"addResource",value:function(e,t){var r=this,n=h.buildCommandRequest.call(this,"resource/create",e);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.addResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"addResource")).then(function(e){return t?h.waitForIndex.call(r,e.response.id).then(function(){return e}):e})}},{key:"addResourceAccess",value:function(e,t,r,n){var a=h.buildCommandRequest.call(this,"resourceAccess/add",{rid:e,aid:t,src:r,acc:[].concat(n)});return h.fetchWithDeadline.call(this,a).catch(function(e){return f("TDXApi.addResourceAccess: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"addResourceAccess"))}},{key:"deleteResource",value:function(e){var t=h.buildCommandRequest.call(this,"resource/delete",{id:e});return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.deleteResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteResource"))}},{key:"deleteManyResources",value:function(e){var t=h.buildCommandRequest.call(this,"resource/deleteMany",{payload:e});return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.deleteManyResources: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteManyResources"))}},{key:"fileUpload",value:function(e,t,r){var n=new Request(this.config.commandServer+"/commandSync/resource/"+e+"/upload",{method:"POST",mode:"cors",headers:new Headers({Authorization:"Bearer "+this.accessToken,"Content-Disposition":'attachment; filename="'+t.name+'"',"Content-Length":t.size}),body:t}),a=h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.fileUpload: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))});return r?a:a.then(function(e){return[e,e.text()]}).spread(function(e,t){return e.ok?Promise.resolve(t):Promise.reject((0,h.handleError)("fileUpload",{code:"failure",message:t}))})}},{key:"moveResource",value:function(e,t,r){var n=h.buildCommandRequest.call(this,"resource/move",{id:e,fromParentId:t,toParentId:r});return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.moveResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"moveResource"))}},{key:"rebuildResourceIndex",value:function(e){var t=this,r=h.buildCommandRequest.call(this,"resource/index/rebuild",{id:e}),n=void 0;return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.rebuildResourceIndex: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"rebuildIndex")).then(function(e){return n=e,h.waitForIndex.call(t,n.response.id,"built")}).then(function(){return n})}},{key:"removeResourceAccess",value:function(e,t,r,n,a){var s=h.buildCommandRequest.call(this,"resourceAccess/delete",{rid:e,aid:t,by:r,src:n,acc:a});return h.fetchWithDeadline.call(this,s).catch(function(e){return f("TDXApi.removeResourceAccess: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"removeResourceAccess"))}},{key:"setResourceSchema",value:function(e,t){var r=h.buildCommandRequest.call(this,"resource/schema/set",{id:e,schema:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.setResourceSchema: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"setResourceSchema"))}},{key:"setResourceShareMode",value:function(e,t){var r=h.buildCommandRequest.call(this,"resource/setShareMode",{id:e,shareMode:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.setResourceShareMode: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"setResourceShareMode"))}},{key:"setResourcePermissiveShare",value:function(e,t){var r=h.buildCommandRequest.call(this,"resource/setPermissiveShare",{id:e,permissiveShare:t?"r":""});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.setResourcePermissiveShare: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"setResourcePermissiveShare"))}},{key:"suspendResourceIndex",value:function(e){var t=this,r=h.buildCommandRequest.call(this,"resource/index/suspend",{id:e}),n=void 0;return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.suspendResourceIndex: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"suspendIndex")).then(function(e){return n=e,h.waitForIndex.call(t,n.response.id,"suspended")}).then(function(){return n})}},{key:"truncateResource",value:function(e){var t=h.buildCommandRequest.call(this,"resource/truncate",{id:e});return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.truncateResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"truncateResource"))}},{key:"updateResource",value:function(e,t){var r=h.buildCommandRequest.call(this,"resource/update",o({id:e},t));return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.updateResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"updateResource"))}},{key:"addData",value:function(e,t){var r={datasetId:e,payload:[].concat(t)},n=h.buildCommandRequest.call(this,"dataset/data/createMany",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.createData: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"updateData"))}},{key:"deleteData",value:function(e,t){var r={datasetId:e,payload:[].concat(t)},n=h.buildCommandRequest.call(this,"dataset/data/deleteMany",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.deleteData: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteData"))}},{key:"deleteDataByQuery",value:function(e,t){var r={datasetId:e,query:t},n=h.buildCommandRequest.call(this,"dataset/data/deleteQuery",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.deleteDataByQuery: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteDataByQuery"))}},{key:"patchData",value:function(e,t){var r={datasetId:e,payload:[].concat(t)},n=h.buildCommandRequest.call(this,"dataset/data/upsertMany",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.patchData: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"patchData"))}},{key:"updateData",value:function(e,t,r){var n={datasetId:e,payload:[].concat(t),__upsert:!!r},a=h.buildCommandRequest.call(this,"dataset/data/updateMany",n);return h.fetchWithDeadline.call(this,a).catch(function(e){return f("TDXApi.updateData: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"updateData"))}},{key:"updateDataByQuery",value:function(e,t,r){var n={datasetId:e,query:t,update:r},a=h.buildCommandRequest.call(this,"dataset/data/updateQuery",n);return h.fetchWithDeadline.call(this,a).catch(function(e){return f("TDXApi.updateDataByQuery: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"updateDataByQuery"))}},{key:"deleteDatabotHost",value:function(e){var t={payload:e},r=h.buildCommandRequest.call(this,"databot/host/delete",t);return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.deleteDatabotHost: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteDatabotHost"))}},{key:"deleteDatabotInstance",value:function(e){var t={instanceId:[].concat(e)},r=h.buildCommandRequest.call(this,"databot/deleteInstance",t);return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.deleteDatabotInstance: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"deleteDatabotInstance"))}},{key:"getDatabotInstance",value:function(e){var t=h.buildDatabotInstanceRequest.call(this,e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.getDatabotInstance: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getDatabotInstance"))}},{key:"getDatabotInstanceOutput",value:function(e,t){var r=h.buildDatabotInstanceRequest.call(this,"output/"+e+"/"+(t||""));return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.getDatabotInstanceOutput: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getDatabotInstanceOutput"))}},{key:"getDatabotInstanceStatus",value:function(e){var t=h.buildDatabotInstanceRequest.call(this,"status/"+e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.getDatabotInstanceStatus: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getDatabotInstanceStatus"))}},{key:"registerDatabotHost",value:function(e){var t=h.buildDatabotHostRequest.call(this,"register",e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.registerDatabotHost: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"registerDatabotHost"))}},{key:"sendDatabotHostCommand",value:function(e,t,r,n){var a={hostId:t,hostIp:r,hostPort:n,command:e},s=h.buildCommandRequest.call(this,"databot/host/command",a);return h.fetchWithDeadline.call(this,s).catch(function(e){return f("TDXApi.sendDatabotHostCommand: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"sendDatabotHostCommand"))}},{key:"startDatabotInstance",value:function(e,t){var r={databotId:e,instanceData:t},n=h.buildCommandRequest.call(this,"databot/startInstance",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.startDatabotInstance: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"startDatabotInstance"))}},{key:"stopDatabotInstance",value:function(e,t){var r={instanceId:e,mode:t},n=h.buildCommandRequest.call(this,"databot/stopInstance",r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.stopDatabotInstance: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"stopDatabotInstance"))}},{key:"updateDatabotHostStatus",value:function(e){var t=h.buildDatabotHostRequest.call(this,"status",e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.updateDatabotHostStatus: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"updateDatabotHostStatus"))}},{key:"writeDatabotHostInstanceOutput",value:function(e){var t=h.buildDatabotHostRequest.call(this,"output",e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.writeDatabotHostInstanceOutput: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"writeDatabotHostInstanceOutput"))}},{key:"exchangeTDXToken",value:function(e,t){var r=h.buildQueryRequest.call(this,"token/exchange",{token:e,ip:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.exchangeTDXToken: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"exchangeTDXToken"))}},{key:"downloadResource",value:function(e){var t=h.buildQueryRequest.call(this,"resource/"+e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.downloadResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))})}},{key:"getAggregateDataStream",value:function(e,t){t&&"object"===(void 0===t?"undefined":s(t))&&(t=JSON.stringify(t));var r=h.buildQueryRequest.call(this,"datasets/"+e+"/aggregate?pipeline="+t);return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.getAggregateData: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))})}},{key:"getAggregateData",value:function(e,t){return this.getAggregateDataStream(e,t).then(h.checkResponse.bind(null,"getAggregateData"))}},{key:"getDatasetDataStream",value:function(e,t,r,n){var a=h.buildQueryRequest.call(this,"datasets/"+e+"/data",t,r,n);return h.fetchWithDeadline.call(this,a).catch(function(e){return f("TDXApi.getDatasetDataStream: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))})}},{key:"getDatasetData",value:function(e,t,r,n){return this.getDatasetDataStream(e,t,r,n).then(h.checkResponse.bind(null,"getDatasetData"))}},{key:"getDatasetDataCount",value:function(e,t){var r=h.buildQueryRequest.call(this,"datasets/"+e+"/count",t);return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.getDatasetDataCount: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getDatasetDataCount"))}},{key:"getDistinct",value:function(e,t,r,n,a){var s=h.buildQueryRequest.call(this,"datasets/"+e+"/distinct?key="+t,r,n,a);return h.fetchWithDeadline.call(this,s).catch(function(e){return f("TDXApi.getDistinct: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getDistinct"))}},{key:"getResource",value:function(e,t){var r=h.buildQueryRequest.call(this,"resources/"+e);return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.getResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(function(e){return t?e.ok?e.json():404===e.status?null:(0,h.checkResponse)("getResource",e):(0,h.checkResponse)("getResource",e)})}},{key:"getResourceAccess",value:function(e,t,r,n){var a=h.buildQueryRequest.call(this,"resources/"+e+"/access",t,r,n);return h.fetchWithDeadline.call(this,a).catch(function(e){return f("TDXApi.getResourceAccess: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(function(e){return(0,h.checkResponse)("getResourceAccess",e)})}},{key:"getResourceAncestors",value:function(e){var t=h.buildQueryRequest.call(this,"datasets/"+e+"/ancestors");return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.getDatasetAncestors: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getResourceAncestors"))}},{key:"getResources",value:function(e,t,r){var n=h.buildQueryRequest.call(this,"resources",e,t,r);return h.fetchWithDeadline.call(this,n).catch(function(e){return f("TDXApi.getResource: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getResources"))}},{key:"getResourcesWithSchema",value:function(e){var t={"schemaDefinition.parent":e};return this.getResources(t)}},{key:"getTDXToken",value:function(e){var t=h.buildQueryRequest.call(this,"tdx-token/"+e);return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.getTDXToken: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getTDXToken"))}},{key:"getZone",value:function(e){var t=h.buildQueryRequest.call(this,"zones",{username:e});return h.fetchWithDeadline.call(this,t).catch(function(e){return f("TDXApi.getZone: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"getZone"))}},{key:"validateTDXToken",value:function(e,t){var r=h.buildQueryRequest.call(this,"token/validate",{token:e,ip:t});return h.fetchWithDeadline.call(this,r).catch(function(e){return f("TDXApi.validateTDXToken: %s",e.message),Promise.reject(new Error(e.message+" - [network error]"))}).then(h.checkResponse.bind(null,"validateTDXToken"))}}]),e}();t.default=p,e.exports=t.default},function(e,t){e.exports=r},function(e,t){e.exports=n}])});